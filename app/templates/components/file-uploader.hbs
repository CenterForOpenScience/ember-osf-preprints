{{#if (eq uploadIntent 'newNodeNewFile')}}
    {{dropzone-widget
        url=url
        options=dropzoneOptions
        sending=(action 'sending')
        buildUrl=(action 'getUrl')
        complete=(action 'complete')
        preUpload=(action 'preUpload')
        defaultMessage='Drop preprint file here to upload'
        maxfilesexceeded=(action 'maxfilesexceeded')
    }}
    {{#if hasFile}}
        {{preprint-title-editor nodeTitle=nodeTitle titleValid=titleValid}}
    {{/if}}
{{else}}
    {{#cp-panel name='uploadNewFile'}}
        {{#cp-panel-toggle tagName='div'}}
            Choose File
            {{#if file}}
                {{file.name}}
            {{/if}}
        {{/cp-panel-toggle}}
        {{#cp-panel-body}}
            {{dropzone-widget
                url=url
                options=dropzoneOptions
                sending=(action 'sending')
                buildUrl=(action 'getUrl')
                complete=(action 'complete')
                preUpload=(action 'preUpload')
                defaultMessage='Drop preprint file here to upload'
                maxfilesexceeded=(action 'maxfilesexceeded')
            }}
        {{/cp-panel-body}}
    {{/cp-panel}}

    {{#liquid-if (and selectedNode (or hasFile selectedFile)) use='crossFade'}}
        {{#cp-panel name='organize'}}
            {{#cp-panel-toggle tagName='div'}}
                Organize

                {{#if (eq convertOrCopy 'convert')}}
                    The current project/component will contain the preprint.
                {{/if}}

                {{#if (eq convertOrCopy 'copy')}}
                    A new component inside the current project will contain the preprint.
                {{/if}}

                {{#if nodeTitle}}
                    {{nodeTitle}}
                {{/if}}
            {{/cp-panel-toggle}}
            {{#cp-panel-body}}
                 <div class="m-t-lg">
                    {{convert-or-copy-project convertOrCopy=convertOrCopy nodeTitle=nodeTitle node=node titleValid=titleValid convertProjectConfirmed=convertProjectConfirmed}}
                </div>

                {{#liquid-if convertOrCopy use='crossFade'}}
                    {{#if (eq convertOrCopy 'convert')}}
                        {{#if convertProjectConfirmed}}
                            <p> Edit preprint title </p>
                            {{preprint-title-editor nodeTitle=nodeTitle titleValid=titleValid}}
                        {{/if}}
                    {{else}}
                        <p> Add preprint title</p>
                        {{preprint-title-editor nodeTitle=nodeTitle titleValid=titleValid}}
                    {{/if}}
                {{/liquid-if}}
            {{/cp-panel-body}}
        {{/cp-panel}}
    {{/liquid-if}}
{{/if}}


<div class="p-t-xs pull-right">
    <button class="btn btn-default" {{action changeState startState}}>Back</button>
    <button class="btn btn-primary" disabled={{or (and (eq convertOrCopy 'convert') (not convertProjectConfirmed))(not (and (not uploadInProgress)(and hasFile titleValid)))}} {{action 'setNodeAndFile'}}>Next</button>
</div>