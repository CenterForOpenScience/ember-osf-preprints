{{#cp-panels accordion=true}}
    {{#preprint-form-section class="upload-section-block" allowOpen=true name='chooseProject' open=true}}
        {{preprint-form-header name='Choose Project' selectedNode=selectedNode showValidationIndicator=false}}
        {{#preprint-form-body}}
            <p class="text-muted">
                The list of projects appearing in the selector are projects and components for which you have admin access.  Deleted projects and registrations are not included here.
            </p>
            {{#if (not userNodesLoaded)}}
                <div class="text-center">
                    {{fa-icon 'spinner' pulse=true size=3}}
                </div>
            {{else}}
                {{#if userNodes}}
                    <div class="p-b-md">
                        {{#power-select options=userNodes searchField='title' selected=selectedNode onchange=(action "nodeSelected") as |node|}}
                            <strong>{{node.title}}</strong>
                        {{/power-select}}
                    </div>
                {{else}}
                    <p class="m-t-md text-danger"> You have no valid nodes that can be converted into a preprint.  Go back to upload a new preprint. </p>
                {{/if}}
            {{/if}}
        {{/preprint-form-body}}
    {{/preprint-form-section}}
    {{#if selectedNode}}
        {{#if isAdmin}}
            {{#if (and fileSelect (eq existingState _existingState.CHOOSE))}}
                {{#preprint-form-section class="upload-section-block" allowOpen=true name='chooseFile' open=false}}
                    {{preprint-form-header name='Choose File' showValidationIndicator=false}}
                    {{#preprint-form-body}}
                        <form class="form">
                            <div class="toggle-button">
                                <div class="row">
                                    <div class="col-xs-3 col-xs-offset-3 text-center">
                                        <input id='existing' class="radio_item" onchange={{action 'changeExistingState' _existingState.NEWFILE}} type="radio" checked={{eq existingState _existingState.NEWFILE}}>
                                        <label for="existing" class='choose-large'><i class="fa fa-cloud-upload"></i> Upload preprint</label>
                                    </div>
                                    <div class="col-xs-3 text-center">
                                        <input id='newfile' class="radio_item" onchange={{action 'changeExistingState' _existingState.EXISTINGFILE}} type="radio" checked={{eq existingState _existingState.EXISTINGFILE}}>
                                        <label class='choose-large' for="newfile"><i class="fa fa-th-list"></i>Select existing file as preprint</label>
                                    </div>
                                </div>
                            </div>
                        </form>
                    {{/preprint-form-body}}
                {{/preprint-form-section}}
            {{/if}}
            {{#if (eq existingState _existingState.EXISTINGFILE)}}
                <div>
                    {{#if osfProviderLoaded}}
                        {{#preprint-form-section class="upload-section-block" allowOpen=true name='selectExistingFile' open=false}}
                            {{preprint-form-header name='Choose File' selectedFile=selectedFile showValidationIndicator=false}}
                            {{#preprint-form-body}}
                                <div class="m-t-sm">
                                    <form class="form">
                                        <div class="toggle-button">
                                            <input id='existing' onchange={{action 'changeExistingState' _existingState.NEWFILE}} type="radio" checked={{eq existingState _existingState.NEWFILE}}>
                                            <label for="existing"><i class="fa fa-cloud-upload"></i> </label>

                                            <input id='newfile' onchange={{action 'changeExistingState' _existingState.EXISTINGFILE}} type="radio" checked={{eq existingState _existingState.EXISTINGFILE}}>
                                            <label for="newfile"><i class="fa fa-th-list"></i> </label>
                                        </div>
                                    </form>
                                </div>
                                {{file-browser rootItem=osfStorageProvider openFile=(action 'selectFile')}}
                            {{/preprint-form-body}}
                        {{/preprint-form-section}}
                        {{#if (and selectedNode (or hasFile selectedFile)) use='crossFade'}}
                            {{#preprint-form-section class="upload-section-block" allowOpen=true name='organize' open=false}}
                                {{preprint-form-header convertOrCopy=convertOrCopy name='Organize' showValidationIndicator=false}}
                                {{#preprint-form-body}}
                                    {{convert-or-copy-project nodeTitle=nodeTitle node=node titleValid=titleValid convertProjectConfirmed=convertProjectConfirmed convertOrCopy=convertOrCopy}}
                                {{/preprint-form-body}}
                            {{/preprint-form-section}}
                            {{#if (or (eq convertOrCopy 'copy') (and (eq convertOrCopy 'convert') convertProjectConfirmed)) use='crossFade'}}
                                {{#preprint-form-section class="upload-section-block" allowOpen=true name='finalizeUpload' open=false}}
                                    {{preprint-form-header nodeTitle=nodeTitle name='Finalize Upload' showValidationIndicator=false}}
                                    {{#preprint-form-body}}
                                        {{#if (eq convertOrCopy 'convert')}}
                                            {{#if convertProjectConfirmed}}
                                                <label class="text-muted title-label"> Edit preprint title </label>
                                            {{/if}}
                                        {{/if}}
                                        {{preprint-title-editor nodeTitle=nodeTitle titleValid=titleValid}}
                                        <div class="row text-center m-v-md">
                                            <p> You are about to initiate the preprint process.  You will not be able to update your project or file after this point. </p>
                                            <button class="btn btn-primary" disabled={{or (and (eq convertOrCopy 'convert') (not convertProjectConfirmed))(not (and selectedFile titleValid))}} {{action (if (eq convertOrCopy 'convert') existingNodeExistingFile createComponentCopyFile) name}}>Save and continue</button>
                                        </div>
                                    {{/preprint-form-body}}
                                {{/preprint-form-section}}
                            {{/if}}
                        {{/if}}
                    {{/if}}
                </div>
            {{else if (eq existingState _existingState.NEWFILE)}}
                {{file-uploader
                    changeState=changeState
                    changeExistingState = (action "changeExistingState")
                    finishUpload=finishUpload
                    startState=startState
                    nodeTitle=nodeTitle
                    currentUser=currentUser
                    osfFile=selectedFile
                    hasFile=hasFile
                    file=file
                    contributors=contributors
                    node=node
                    selectedNode=selectedNode
                    userNodes=userNodes
                    parentNode=parentNode
                    convertProjectConfirmed=convertProjectConfirmed
                    convertOrCopy=convertOrCopy
                    uploadNewFileSectionOpened=uploadNewFileSectionOpened
                    existingState=existingState
                    _existingState=_existingState
                }}
            {{/if}}
        {{else}}
            {{#unless (eq currentState 'start')}}
                <p class="alert alert-danger" role="alert">
                    You must be the admin of this component to share it.

                    Please ask the admin of this project to make you an admin
                    so you may share this component.
                </p>
            {{/unless}}
        {{/if}}
    {{/if}}
{{/cp-panels}}
 <div class="p-t-xs">
     <button class="btn btn-default" {{action changeState startState}}>Back</button>
 </div>